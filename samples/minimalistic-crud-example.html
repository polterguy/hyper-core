<!DOCTYPE html>
<html>
  <head>
    <title>A CRUD database example!</title>
  </head>
  <body>
    <h1>CRUD example</h1>
    <ul id="names"></ul>
    <button onclick="insert();return false;">Insert</button>
    <script>

/*
 * Function that populates "ul" element above, with the ten first records
 * from your database.
 */
function get_data () {

  /*
   * Retrieves our above "ul" element, and creates an XHR object, to retrieve JSON
   * data from the server.
   */
  var ul = document.getElementById ('names');
  var xhr = new XMLHttpRequest();

  /*
   * Retrieving first 10 items from our database, making sure we order them ascendingly.
   */
  xhr.open('GET', '/hyper-core/database/camphora/foo/select', true);

  /*
   * Creating a "onfinished" callback for our XHR object.
   */
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      eval("window.res = " + xhr.responseText);
      for (var idx = 0; idx < res.length; idx++) {
        var el = document.createElement('li');
        el.innerHTML = res [idx].name;
        ul.appendChild(el);
      }
    }
  };
  xhr.send();
}

/*
 * Populates "ul" element above, using our HTTP REST "select" wrapper function created above.
 */
get_data();


/*
 * Asks user to provide a name, and invokes our server side HTTP REST database "insert" method.
 */
function insert () {

  /*
   * Asks user to provide us with a name.
   */
  var name = prompt('Enter some name', 'John Doe');

  /*
   * Creates our XHR object, which will invoke our "insert" method on the server side.
   */
  var xhr = new XMLHttpRequest();

  /*
   * Invoking our "insert" method, notice contrary to our "select" method, our
   * "insert" method requires us to use the HTTP POST verb.
   */
  xhr.open('PUT', '/hyper-core/database/camphora/foo/insert', true);
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

  /*
   * Creating a "onfinished" callback for our XHR object.
   */
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      eval("window.res = " + xhr.responseText);
      alert('Item was successfully inderted with the id of; ' + window.res.id);
    }
  };
  var body = 'name=' + name;
  xhr.send(body);
}
    </script>
  </body>
</html>
